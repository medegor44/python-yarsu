# Часть 1: Инициализация
**Задача:** Создать базу данных и таблицы.
1.  **Создайте новый файл `bookstore.py`.**
2.  **Подключитесь к базе данных**.
3.  **Создайте две таблицы** с помощью `cursor.execute()`:

    **Таблица `authors`:**
    *   `id` (INTEGER, PRIMARY KEY)
    *   `name` (TEXT, NOT NULL)
    *   `country` (TEXT)

    **Таблица `books`:**
    *   `id` (INTEGER, PRIMARY KEY)
    *   `title` (TEXT, NOT NULL)
    *   `author_id` (INTEGER, FOREIGN KEY REFERENCES authors(id))
    *   `price` (REAL, NOT NULL)
    *   `quantity` (INTEGER, DEFAULT 0)

# Часть 2: Наполнение данными 

**Задача:** Написать функцию для добавления авторов и книг.

1.  **Напишите функцию `add_author(name, country)`**, которая принимает имя и страну автора, и добавляет запись в таблицу `authors`. Функция должна возвращать `id` только что добавленного автора.
2.  **Напишите функцию `add_book(title, author_id, price, quantity)`** для добавления книг.
3.  **Добавьте в базу данных** как минимум 3-х авторов и 5-6 книг, используя созданные функции.

**Пример данных:**
*   **Авторы:** Лев Толстой (Россия), Джоан Роулинг (Великобритания), Фрэнк Герберт (США).
*   **Книги:** "Война и мир" (Толстой, 1200.0, 10), "Гарри Поттер и Философский камень" (Роулинг, 800.5, 15), "Дюна" (Герберт, 950.0, 5).
# Часть 3: Чтение и обработка данных

**Задача:** Написать несколько функций для выборки данных.

1.  **`get_all_books()`:** Возвращает список всех книг вместе с именами авторов (используйте `JOIN`). Выводит красиво отформатированный список в консоль.
    *   *Вывод:* `1. Война и мир | Лев Толстой | 1200.0 руб. | В наличии: 10 шт.`
2.  **`find_books_by_author(author_name)`:** Принимает имя автора (или его часть) и возвращает все его книги. Используйте параметризованный запрос с `LIKE` для безопасности от SQL-инъекций.
3.  **`get_books_in_price_range(min_price, max_price)`:** Возвращает книги, цена которых находится в указанном диапазоне.
4.  **`search_books(query)`**: Ищет книги по названию и имени автора одновременно.
# Часть 4: Обновление и удаление данных 

**Задача:** Реализовать логику обновления остатков и удаления книг.

1.  **`update_book_quantity(book_id, new_quantity)`:** Обновляет количество книг на складе по её `id`.
2.  **`apply_discount(author_name, discount_percent)`:** Применяет скидку (уменьшает цену) на все книги указанного автора. Например, скидка 10% на все книги Толстого.
    *   *Формула:* `новая_цена = цена * (1 - discount_percent / 100)`
3.  **`delete_book(book_id)`:** Удаляет книгу из базы данных по её `id`. Напишите проверку, что такая книга существует, перед удалением.
# Часть 5: Обработка ошибок и транзакции

**Задача:** Сделать код более надёжным.

1.  **Обработка ошибок:** Оберните критические участки кода (особенно при операции UPDATE/DELETE) в блоки `try...except`. Отлавливайте конкретные исключения `sqlite3.Error` (или `psycopg2.Error`).
2.  **Транзакция:** Смоделируйте продажу книги.
    *   Напишите функцию `sell_book(book_id, quantity_sold)`.
    *   Функция должна:
        1.  Проверить, есть ли достаточное количество книг на складе.
        2.  Если да - уменьшить `quantity` на `quantity_sold`.
        3.  Если нет - вывести сообщение об ошибке и **не изменять** базу данных.
    *   Используйте `connection.commit()` только в случае успешного выполнения всех операций. В случае ошибки - выполните `connection.rollback()`.


